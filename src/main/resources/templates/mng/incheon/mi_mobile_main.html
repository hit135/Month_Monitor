<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="utf-8">
<title>Firesens Manager (Daejeon Smart city Challenge)</title>
<meta name="description" content="Analytics Dashboard" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Call App Mode on ios devices -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<!-- Remove Tap Highlight on Windows Phone IE -->
<meta name="msapplication-tap-highlight" content="no" />

<!-- base css -->
<link rel="icon" type="image/png" sizes="32x32" th:href="@{/fs/img/favicon/favicon.ico}" />
<link id="vendorsbundle" rel="stylesheet" media="screen, print" th:href="@{/smartadmin/css/vendors.bundle.css}" />
<link id="appbundle" rel="stylesheet" media="screen, print" th:href="@{/smartadmin/css/app.bundle.css}" />
<link id="mytheme" rel="stylesheet" media="screen, print" th:href="@{/smartadmin/css/themes/cust-theme-8.css}" />
<link id="myskin" rel="stylesheet" media="screen, print" th:href="@{/smartadmin/css/skins/skin-master.css}" />

<!-- additional css -->
<link rel="stylesheet" type="text/css" th:href="@{/fs/css/apexcharts.css}" />

<!-- base javascript -->
<script type="text/javascript" th:src="@{/fs/js/jquery.js}"></script>

<style>
@media(orientation: portrait) {
  html {
    transform: rotate(-90deg); transform-origin: top left; position: absolute; top: 100%; left: 0; width: 100vh; height: 100vw;
  }
}

body { overflow-x: scroll; overflow-y: scroll; }

#mimm_panel_title { font-size: 20px; font-weight: 800; padding: 10px 0px 10px 15px; }

#mimm_panel_area_div { padding: 15px 0 15px 15px; width: 84vh; }
#mimm_panel_snsr_legend_div { font-size: 18px; background-color: #fff; padding: 0.5rem; }
.mimm_panel_snsr_legend_rect { padding: 12px; }

#mimm_panel_snsr_state_div {
  width: 100%; height: 425px; border: 2px solid #2F528F; background-color: #fff;
  background-image: url('/fs/img/incheon/incheon_panel.png'); background-repeat: no-repeat; background-size: auto 100%; background-position: center;
}

.mimm_panel_div {
  width: 26%; height: 34px; font-size: 13px; padding: 0 0.5rem; display: flex; justify-content: space-between; align-items: center;
}

#mimm_panel_tbl_div { margin-top: 2rem; }
.mimm_snsr_info_title { font-weight: 800; font-size: 20px; margin-bottom: 10px; }
#mimm_rst_tbl th, #mimm_rst_tbl td, #mimm_snsr_tbl th, #mimm_snsr_tbl td { font-size: 13px; padding: 0.15rem; }
#mimm_rst_tbl td, #mimm_snsr_tbl td { background-color: #fff; }
#mimm_rst_tbl th, #mimm_snsr_tbl th { text-align: center; font-weight: 800; }
</style>
</head>

<body>
<input id="contextRoot" type="hidden" th:value="${#httpServletRequest.getContextPath()}" />

<div id="mimm_panel_title">인천 종합비즈니스 센터 관제 현황</div>
<div style="background-color: #BEBEBE;">
  <div id="mimm_panel_area_div">
    <div class="mimm_snsr_info_title">분전반현황</div>

    <div class="form-inline" id="mimm_panel_snsr_legend_div">
      <span class="mimm_panel_snsr_legend_rect" style="background-color: #00B050;"></span>
      <span class="ml-2">정상</span>
      <span class="ml-3 mimm_panel_snsr_legend_rect" style="background-color: #FFBF87;"></span>
      <span class="ml-2">주의</span>
      <span class="ml-3 mimm_panel_snsr_legend_rect" style="background-color: #FF2F44;"></span>
      <span class="ml-2">경고</span>
      <span class="ml-3 mimm_panel_snsr_legend_rect" style="background-color: #BEBEBE;"></span>
      <span class="ml-2">끊김</span>
      <span class="ml-3 mimm_panel_snsr_legend_rect" style="background-color: #6B6B6B;"></span>
      <span class="ml-2">미사용</span>
    </div>

    <div id="mimm_panel_snsr_state_div">
      <div class="d-flex justify-content-between" style="position: relative; top: 126px;">
        <div class="mimm_panel_div" id="mimm_panel_00"></div>
        <div class="mimm_panel_div" id="mimm_panel_01"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 136px;">
        <div class="mimm_panel_div" id="mimm_panel_02"></div>
        <div class="mimm_panel_div" id="mimm_panel_03"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 144px;">
        <div class="mimm_panel_div" id="mimm_panel_04"></div>
        <div class="mimm_panel_div" id="mimm_panel_05"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 150px;">
        <div class="mimm_panel_div" id="mimm_panel_06"></div>
        <div class="mimm_panel_div" id="mimm_panel_07"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 158px;">
        <div class="mimm_panel_div" id="mimm_panel_08"></div>
        <div class="mimm_panel_div" id="mimm_panel_09"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 166px;">
        <div class="mimm_panel_div" id="mimm_panel_10"></div>
        <div class="mimm_panel_div" id="mimm_panel_11"></div>
      </div>
      <div class="d-flex justify-content-between" style="position: relative; top: 173px;">
        <div class="mimm_panel_div" id="mimm_panel_12"></div>
        <div class="mimm_panel_div" id="mimm_panel_13"></div>
      </div>
    </div>

    <div id="mimm_panel_tbl_div"></div>
  </div>
</div>

<script th:src="@{/fs/js/polyfill.min.js}"></script>

<script type="text/javascript">
$(function () {
  fn_mimm_init();
});

function fn_mimm_init() {
  fn_mimm_getCurrSnsrState();
  fn_mimm_getCurrSnsrInfo();
}

function fn_mimm_getCurrSnsrState() {
  $.post(
    $('#contextRoot').val() + '/mng/incheon/currSnsrStateAjax',
    {},
    function (d) {
      if (d.length) {
        for (let i = 0; i < d.length; i++) {
          let id = '';

          if (d[i].SNSRID == '1718') id = '#mimm_panel_00';
          else if (d[i].SNSRID == '1719') id = '#mimm_panel_01';
          else if (d[i].SNSRID == '4304') id = '#mimm_panel_02';
          else if (d[i].SNSRID == '3601') id = '#mimm_panel_05';
          else if (d[i].SNSRID == '3602') id = '#mimm_panel_07';
          else if (d[i].SNSRID == '4303') id = '#mimm_panel_08';
          else if (d[i].SNSRID == '3603') id = '#mimm_panel_09';
          else if (d[i].SNSRID == '4302') id = '#mimm_panel_10';
          else if (d[i].SNSRID == '3604') id = '#mimm_panel_11';
          else if (d[i].SNSRID == '4301') id = '#mimm_panel_12';
          else if (d[i].SNSRID == '3605') id = '#mimm_panel_13';

          $(id).html('<span>' + d[i].SNSRNICK + '</span><span>' + d[i].SNSRID + '</span>');

          let cssStyle = {};
          if (d[i].STATE == 'DANGER') cssStyle = { 'backgroundColor': '#FF2F44', 'color': '#fff' };
          else if (d[i].STATE == 'WARN') cssStyle = { 'backgroundColor': '#FFBF87', 'color': '#000' };
          else if (d[i].STATE == 'DISCONN') cssStyle = { 'backgroundColor': '#BEBEBE', 'color': '#000'};
          else if (d[i].STATE == 'NORMAL') cssStyle = { 'backgroundColor': '#00B050', 'color': '#fff' };

          $(id).css(cssStyle);
        }
      }}
  );

  $("#mimm_panel_03").html('<span>L-2 (미사용)</span>');
  $("#mimm_panel_04").html('<span>L-3 (미사용)</span>');
  $("#mimm_panel_06").html('<span>미사용</span>');
  $("#mimm_panel_03, #mimm_panel_04, #mimm_panel_06").css({ 'backgroundColor': '#6B6B6B', 'color': '#fff' });
}

function fn_mimm_getCurrSnsrInfo() {
  $("#mimm_panel_tbl_div").empty();
  let html = '';

  html += '<div class="mimm_snsr_info_title">기본정보</div>';

  $.post(
    $('#contextRoot').val() + '/mng/incheon/currSnsrInfoAjax',
    {},
    function (resu) {
      if (resu) {
        html += '<table class="mt-1 mb-0 table table-bordered" id="mimm_rst_tbl">'
             +    '<thead class="thead-light">'
             +      '<tr>'
             +        '<th>구분</th>'
             +        '<th>단상</th>'
             +        '<th>IGO<br/>[mA]</th>'
             +        '<th>IGR<br/>[mA]</th>'
             +        '<th>IGC<br/>[mA]</th>'
             +        '<th>전류<br/>[A]</th>'
             +        '<th>전압<br/>[V]</th>'
             +        '<th>전력량<br/>[kWh]</th>'
             +      '</tr>'
             +    '</thead>'
             +    '<tbody>';

        if (resu.resultRstList) {
          for (let i = 0; i < resu.resultRstList.length; i++) {
            let item = resu.resultRstList[i];

            html += '<tr>';
            if (i == 0)
              html += '<td rowspan="' + resu.resultRstList.length + '">삼상</td>';

            html += '<td>' + item.TYPE + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGO + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGR + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGC + '</td>'
                 +  '<td class="text-right">' + item.SNSRAMPERE + '</td>'
                 +  '<td class="text-right">' + item.SNSRVOLT + '</td>'
                 +  '<td class="text-right">' + item.SNSRKWH + '</td>'

            html += '</tr>';
          }
        } else {
          html += '<tr><td colspan="8">데이터가 없습니다.</td></tr>';
        }

        html += '</tbody></table>';

        html += '<table class="mt-3 mb-0 table table-bordered" id="mimm_snsr_tbl">'
             +    '<thead class="thead-light">'
             +      '<tr>'
             +        '<th>구분</th>'
             +        '<th>분기명</th>'
             +        '<th>IGO<br/>[mA]</th>'
             +        '<th>IGR<br/>[mA]</th>'
             +        '<th>IGC<br/>[mA]</th>'
             +        '<th>전류<br/>[A]</th>'
             +        '<th>전압<br/>[V]</th>'
             +        '<th>전력량<br/>[kWh]</th>'
             +        '<th>수신감도<br/>[dBm]</th>'
             +      '</tr>'
             +    '</thead>'
             +    '<tbody>';

        if (resu.resultSnsrList) {
          for (let i = 0; i < resu.resultSnsrList.length; i++) {
            let item = resu.resultSnsrList[i];

            html += '<tr>';
            if (i == 0)
              html += '<td rowspan="' + resu.resultSnsrList.length + '">분기</td>';

            html += '<td>' + item.SNSRNICK + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGO + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGR + '</td>'
                 +  '<td class="text-right">' + item.SNSRIGC + '</td>'
                 +  '<td class="text-right">' + item.SNSRAMPERE + '</td>'
                 +  '<td class="text-right">' + item.SNSRVOLT + '</td>'
                 +  '<td class="text-right">' + item.SNSRKWH + '</td>'
                 +  '<td class="text-right">' + item.SNSRRSSI + '</td>'

            html += '</tr>';
          }}}

      $("#mimm_panel_tbl_div").html(html);
  });
}
</script>
</body>
</html>