<div class="row">
  <div class="col-12">
    <div class="sensors-DANGER" style="border: 1px solid #ff2f44;">
      <h3 class="bg-danger"><i class="fal fa-siren-on"></i> 경고 <span class="cnt"></span></h3>
      <div class="list-sensor"></div>
    </div><!-- /.sensors-DANGER -->
    <div class="sensors-WARN" style="border: 1px solid #ffbf87;">
      <h3 class="bg-warning"><i class="fal fa-exclamation-triangle"></i> 주의 <span class="cnt"></span></h3>
      <div class="list-sensor"></div>
    </div><!-- /.sensors-WARN -->
    <div class="sensors-BROKEN" style="border: 1px solid #6c757d;">
      <h3 class="bg-secondary"><i class="fal fa-sensor-alert"></i> 고장 <span class="cnt"></span></h3>
      <div class="list-sensor"></div>
    </div><!-- /.sensors-BROKEN -->
  </div><!-- /.col-12 -->
</div><!-- /.row -->

<script type="text/javascript">
$(function () {
  $.template(
    'right-sensor',
    '<p class="right-sensor" data-areacode="{{html AREACODE}}" data-strcode="{{html STRCODE}}" data-code="{{html SNSRID}}">' +
      '{{html AREANAME}}_{{html SNSRNICK}} ' + 
      '<span style="color: red;">({{html CNT}})</span>' +
    '</p>'
  );

  $('.list-sensor').on('click', 'p', function () {
    fn_mclr_clickRightSensor($(this).attr('data-areacode'), $(this).attr('data-strcode'), $(this).attr('data-code'));
  });

  fn_mclr_getRightSensorList();
});

function fn_mclr_getRightSensorList() {
  $.post(
    $('#contextRoot').val() + '/mng/todayAbnormalSensorListAjax',
    {},
    function (d) {
      $('.list-sensor').html('');

      for (let i = 0; i < d.length; i++)
        $('.sensors-' + d[i].STATE + ' .list-sensor').append($.tmpl('right-sensor', d[i]));

      $('.sensors-DANGER .cnt').text('(' + $('.sensors-DANGER .list-sensor p').length + ')');
      $('.sensors-WARN .cnt').text('(' + $('.sensors-WARN .list-sensor p').length + ')');
      $('.sensors-BROKEN .cnt').text('(' + $('.sensors-BROKEN .list-sensor p').length + ')');
  });
}

// 경고 / 주의 / 고장에서 상점 선택
function fn_mclr_clickRightSensor(code, strcode, snsrid) {
  window.center_name = 'store';

  fn_mcm_toggleCenterCont();
  fn_mcst_onAreaLv2(code, strcode, snsrid);
}

function fn_mclr_refreshRight() {
  fn_mclr_getRightSensorList();
}
</script>