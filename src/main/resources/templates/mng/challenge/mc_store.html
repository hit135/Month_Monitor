<div>
  <div class="center-store-cont">
    <div class="row center-top p-1">
      <div class="area-name col-3"></div>
      <div class="area-stat col-9">
        <span>상점수</span><b class="store"></b>&nbsp;&nbsp;
        [<span>센서수</span><b class="sensor"></b>&nbsp;/&nbsp;
        <span>경고</span><b class="danger"></b>&nbsp;/&nbsp;
        <span>주의</span><b class="warn"></b>&nbsp;/&nbsp;
        <span>끊김</span><b class="discon"></b>]
      </div><!-- /.area-stat col-8 -->
    </div><!-- /.row -->
    <div class="row">
      <div class="center-left col-md-3 col-12">
        <div class="center-left-sensor-list"></div>
      </div><!-- /.col-md-3 -->
      <div class="center-cont col-md-9 col-12">
        <div class="row center-cont-top">
          <div class="store-name col-4"></div>
          <div class="cont-btn col-8">
            <span class="center-cont-top-btn on" data-page="Info">기본정보</span>
            <span class="center-cont-top-btn" data-page="Log">경보이력</span>
            <span class="center-cont-top-btn" data-page="Chart">분석차트</span>
            <span class="center-main-btn">Main Page</span>
          </div><!-- /.col-8 -->
        </div><!-- /.row -->
        <div class="row center-cont-page"></div>
      </div><!-- /.col-md-9 -->
    </div><!-- /.row -->
  </div><!-- /.center-store-cont (시장 내 상점정보) -->

  <script type="text/javascript">
  $(function () {
    // 시장 내 왼쪽 상점 목록 선택
    $('.center-left-sensor-list').on('click', 'p', function () {
      $('.center-left-sensor-list p.on').removeClass('on');
      $(this).addClass('on');

      $('.center-cont-top .store-name').text($(this).attr('data-strname'));
      fn_mcst_clickContPage();
    });

    // 시장 정보 위 기본정보 / 경보이력 / 분석차트 선택
    $('.center-cont-top').on('click', '.center-cont-top-btn', function () {
      $('.center-cont-top-btn.on').removeClass('on');
      $(this).addClass('on');

      fn_mcst_clickContPage();
    });
  });

  // 상점 정보 refresh
  function fn_mcst_onAreaLv2(code, strcode, snsrid) {
    if (code) {
      $('.left .area-lv2').removeClass('on');
      $('.left .area-lv2[data-code="' + code + '"]').addClass('on');

      fn_mcst_getTodayAreaState(code);
      fn_mcst_getTodayAreaStoreState(code, strcode, snsrid);
    }
  }

  // 오늘 상점 화면 시장 내 센서 상태 조회 (전체, 경고, 주의, 끊김)
  function fn_mcst_getTodayAreaState(code) {
    $.post(
      $('#contextRoot').val() + '/mng/todayAreaStateAjax',
      { areacode: code },
      function (d) {
        if (d) {
          $('.center .area-name').text(d[0].AREANAME);

          $('.center .area-stat .store').text(d[0].STORE);
          $('.center .area-stat .sensor').text(d[0].SENSOR);
          $('.center .area-stat .danger').text(d[0].DANGER);
          $('.center .area-stat .warn').text(d[0].WARN);
          $('.center .area-stat .discon').text(d[0].DISCON);
        }
    });
  }

  // 시장 내 상점 목록 조회
  function fn_mcst_getTodayAreaStoreState(code, strcode, snsrid) {
    let on_strcode = $('.center-left-sensor-list p.on').attr('data-strcode');
    if (strcode)
      on_strcode = strcode;

    $.post(
      $('#contextRoot').val() + '/mng/todayAreaStoreStateAjax',
      { areacode: code },
      function (d) {
        $('.center-left-sensor-list').html('');

        for (let i = 0; i < d.length; i++) {
          d[i].CNT = 0;

          if (d[i].DANGER > 0) {
            d[i].STATE = 'danger';
            d[i].CNT = d[i].DANGER;
            d[i].CNT2 = d[i].WARN;
          } else if (d[i].WARN > 0) {
            d[i].STATE = 'warn';
            d[i].CNT = d[i].WARN;
          } else if (d[i].CON > 0) {
            d[i].STATE = 'discon';
          }

          $('.center-left-sensor-list').append($.tmpl('center-left-store', d[i]));
        }

        let on_obj = $('.center-left-sensor-list p[data-strcode="' + on_strcode + '"]')[0];
        if (!on_obj)
          on_obj = $('.center-left-sensor-list p')[0];

        $(on_obj).addClass('on');
        $('.center-cont-top .store-name').text($(on_obj).attr('data-strname'));

        if ($('#prm_strcode').val() != $('.center-left-sensor-list p.on').attr('data-strcode'))
          fn_mcst_clickContPage(snsrid ? { snsrid: snsrid } : null);
    });
  }

  // 상점 목록 선택
  function fn_mcst_clickContPage(p) {
    let prm = (p) ?
      p : { areacode: $('.center-left-sensor-list p.on').attr('data-areacode'),
        strcode: $('.center-left-sensor-list p.on').attr('data-strcode') };

    $.post(
      $('#contextRoot').val() + '/mng/store' + $('.center-cont-top-btn.on').attr('data-page'),
      prm,
      function (d) {
        let $temp = $('<div>');
        $temp.html(d);

        $('.center-cont-page').html($temp.find('.sub-cont'));
    });
  }
  </script>
</div>