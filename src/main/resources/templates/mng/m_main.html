<!DOCTYPE html>
  <html lang="en">
  <head>
    <th:block th:replace="mng/layout/m_head"></th:block>
    <style type="text/css">
      .top .sensor-stat { text-shadow:1px 1px 5px #000; color:#fff; }
      .top-date { font-size:16px; padding-top:10px; }
      .top-time { font-size:28px; margin-bottom:-30px; }
      .top-search { padding-top:10px; }
      .top-search-text { -webkit-ime-mode:active; -moz-ime-mode:active; -ms-ime-mode:active; ime-mode:active; }
      .top-search-result { position:absolute; z-index:100; right:0; top:40px; width:300px; max-height:400px; background:#fff; overflow-y:scroll; }
      .top-search-result p { cursor:pointer; }
      .top-search-result p:hover { background:#ddd; }
    </style>
    <style type="text/css">
      .left p { padding:3px 7px; margin-bottom:3px; border-radius:4px; }
      .left span { display:inline-block; text-shadow:1px 1px 5px #fff; }
      .left .name { width:55%; }
      .left .danger { width:20%; text-align:right; color:#ff2f44; }
      .left .warn { width:20%; text-align:right; color:#efaf77; }
      .left .area-lv1 { font-size:20px; font-weight:bold; background:#ddd; width:90%; margin-left:5%; }
      .left .area-lv2 { font-size:14px; font-weight:bold; background:#eee; width:85%; margin-left:10%; border-bottom:1px solid #ccc; cursor:pointer; }
      .left .area-lv2:hover { background:#ccc; }
      .left .area-lv2.on { background:#2b559b; color:white; text-shadow:1px 1px 5px #000; }
      .left h3 { text-align:center; color:#fff; padding:8px; font-size:20px; font-weight:bold; text-shadow:1px 1px 5px #000; }
      .left h3 span { text-shadow:1px 1px 5px #000; }
      .left-list-sensor { height:213px; overflow-y:scroll; padding:5px 10px; }
      .left-list-sensor p { font-size:14px; margin-bottom:7px; cursor:pointer; }
      .left-list-sensor p:hover { background:#e7f0f8; }
    </style>
    <style type="text/css">
      .right [class^=sensors] { margin-bottom:15px; }
      .right h3 { text-align:center; color:#fff; padding:8px; font-size:20px; font-weight:bold; text-shadow:1px 1px 5px #000; }
      .right .list-sensor { height:227px; overflow-y:scroll; padding:5px 10px; }
      .right .list-sensor p { font-size:14px; margin-bottom:7px; cursor:pointer; }
      .right .list-sensor p:hover { background:#e7f0f8; }
    </style>
    <style type="text/css">
      .center-top { background:#2b559b; color:#fff; border-radius:4px; margin-bottom:15px; }
      .center .area-name { font-size:30px; font-weight:bold; }
      .center .area-stat span { display:inline-block; font-size:18px; font-weight:bold; padding:8px; }
      .center-left-sensor-list { height:700px; overflow-y:scroll; direction:rtl; padding:10px; }
      .center-left-sensor-list p { position:relative; padding:5px 10px; border-radius:3px; background:#eee; border-bottom:1px solid #ccc; font-size:14px; font-weight:bold; color:#2b559b; cursor:pointer; margin-bottom:7px; }
      .center-left-sensor-list p span { display:inline-block; width:30px; float:right; background:#8df; color:#fff; font-size:12px; font-weight:bold; text-align:center; text-shadow:1px 1px 5px #000; padding:3px 5px; border-radius:8px; }
      .center-left-sensor-list p span.cnt2 { display:none; }
      .center-left-sensor-list p.danger { color:#ff2f44; }
      .center-left-sensor-list p.warn { color:#efaf77; }
      .center-left-sensor-list p.danger span { color:#fff; background:#f88; }
      .center-left-sensor-list p.danger span.cnt2 { display:inline-block; color:#fff; background:#fd8; }
      .center-left-sensor-list p.warn span { color:#fff; background:#fd8; }
      .center-left-sensor-list p.discon span { color:#fff; background:#999; }
      .center-left-sensor-list p:hover { background:#ccc; }
      .center-left-sensor-list p.on { background:#2b559b; color:white; text-shadow:1px 1px 5px #000; }
      .center-main-cont { height:770px; overflow-x:hidden; overflow-y:scroll; }
      .center-main-cont .panel { margin-bottom:0; }
      .center-main-cont .panel-hdr { background:#2b559b; }
      .center-main-cont .panel-hdr * { color:#ffffff; }
      .center-main-cont .panel-hdr .center-main-area-count span, .center-main-cont .panel-hdr .center-main-area-count b { display:inline-block; width:40px; text-align:right; }
      .center-main-cont .btn-panel { font-size:1rem; color:#fff; width:1.5rem; height:1.5rem; }
      .center-main-cont .center-main-area-title { font-size:24px; font-weight:bold; }
      .center-main-cont .ui-sortable-handle .center-main-area-count { font-size:12px; font-weight:normal; }
      .center-main-cont .panel-hdr .center-main-area-count-store { font-size:16px; font-weight:bold; color:#afd9ee; }
      .center-main-cont .panel-hdr .center-main-area-count-sensor { font-size:16px; font-weight:bold; color:#afd9ee; }
      .center-main-cont .panel-hdr .center-main-area-count-danger { font-size:16px; font-weight:bold; color:#e082ae; }
      .center-main-cont .panel-hdr .center-main-area-count-warn { font-size:16px; font-weight:bold; color:#dbc969; }
      .center-main-cont .panel-hdr .center-main-area-count-discon { font-size:16px; font-weight:bold; color:#dddddd; }
      .center-main-cont .panel-container { height:250px; overflow:hidden; }
      .center-main-area-tab { height:49px; }
      .center-main-cont .panel-fullscreen .center-main-cont-top-btn { display:inline-block; }
      .center-main-cont .panel-fullscreen [class^=center-main-page] { display:none; }
      .center-main-cont .panel-fullscreen [class^=center-main-page].on { display:block; }
      .center-main-cont-top-btn { display:none; font-size:20px; padding:10px 15px; margin-top:20px; line-height:20px; cursor:pointer; }
      .center-main-cont-top-btn:hover { color:#afd9ee; text-decoration:underline; }
      .center-main-cont-top-btn.on { background:#fff; color:#2b559b; font-weight:bold; }

    </style>
    <style type="text/css">
      .center-cont-top { background:#2b559b; color:#fff; height:50px; }
      .center-cont-top .store-name { font-size:24px; line-height:50px; font-weight:bold; }
      .center-cont-top-btn { display:inline-block; font-size:16px; padding:10px; margin-top:10px; cursor:pointer; }
      .center-cont-top-btn:hover { color:#afd9ee; text-decoration:underline; }
      .center-cont-top-btn.on { background:#fff; color:#2b559b; font-weight:bold; }
      .center-main-btn { display:inline-block; float:right; background:#ffc241; color:#000; font-weight:bold; border-radius:4px; margin:10px; padding:5px 10px; cursor:pointer; }
      .center-cont-page { border:1px solid #2b559b; min-height:650px; }
      .center-cont-page .btn-chart { cursor:pointer; }
      .center-cont-page .btn-datalog { cursor:pointer; }
    </style>
    <style type="text/css">
      .store-info .store-meta tr { border-bottom:1px solid #7c91df; margin:0; }
      .store-info .store-meta th { background:#7c91df; width:60px; padding:0; line-height:35px; text-align:center; color:#fff; font-size:12px; font-weight:bold; border-top:1px solid #fff; }
      .store-info .store-meta td { padding:0 10px; line-height:35px; font-size:16px; font-weight:bold; }
      .store-info .store-meta td.store-sensor-cont { font-size:12px; }
      .store-info .store-meta td.store-sensor-cont p { margin:0; }
      .store-info .store-datalog-list { height:200px; overflow-y:scroll; }
      .store-info .store-datalog-list p { font-weight:bold; color:#666; font-size:13px; margin:0; }
      .store-info .store-datalog-list p.DANGER { color:#ff2f44; }
      .store-info .store-datalog-list p.WARN { color:#efaf77; }
      .store-info .store-log-week-stat table { width:100%; table-layout:fixed; }
      .store-info .tbl-bar td { text-align:center; }
      .store-info .tbl-bar td.bl { border-left:3px solid #fff; }
      .store-info .tbl-bar .tr-bar td .block { display:block; position:relative; height:105px; }
      .store-info .tbl-bar .progress-bar { display:block; position:absolute; bottom:0; width:100%; border-radius:3px 3px 0 0; }
      .store-info .tbl-bar .progress-bar.danger-this { font-weight:bold; text-shadow:1px 1px 5px #000; }
      .store-info .tbl-bar .progress-bar.warn-this { font-weight:bold; text-shadow:1px 1px 5px #000; }
      .store-info-sensor-list { margin-bottom:20px; height:200px; overflow-y:scroll; }
      .store-info-sensor-list p.btn-datalog { position:relative; padding:5px 10px; font-size:14px; font-weight:bold; color:#2b559b; margin-bottom:7px; line-height:16px; }
      .store-info-sensor-list p.btn-datalog span { display:inline-block; width:30px; float:right; background:#8df; color:#fff; font-size:12px; font-weight:bold; text-align:center; text-shadow:1px 1px 5px #000; padding:3px 5px; border-radius:8px; }
      .store-info-sensor-list p.btn-datalog span.cnt2 { display:none; }
      .store-info-sensor-list p.danger { color:#ff2f44; }
      .store-info-sensor-list p.warn { color:#efaf77; }
      .store-info-sensor-list p.danger span { color:#fff; background:#f88; }
      .store-info-sensor-list p.danger span.cnt2 { display:inline-block; color:#fff; background:#fd8; }
      .store-info-sensor-list p.warn span { color:#fff; background:#fd8; }
      .store-info-sensor-list p.discon span { color:#fff; background:#999; }
      .store-info-sensor-list p.store-info-check { margin-bottom:0; line-height:20px; }
      .store-info-sensor-list p.store-info-check span { display:inline-block; width:70px; font-weight:bold; font-size:11px; color:#fff; border-radius:10px; text-align:center; cursor:pointer; }
      .store-info-sensor-list p.store-info-check .btn-check-start { background:#999; }
      .store-info-sensor-list p.store-info-check .btn-check-end { background:#47b73a; display:none; }
      .store-info-sensor-list p.store-info-check.CHECKING .btn-check-start { display:none; }
      .store-info-sensor-list p.store-info-check.CHECKING .btn-check-end { display:inline-block; }
    </style>
    <style type="text/css">
      .store-log .store-datalog-meta { width:100%; table-layout:fixed; }
      .store-log .store-datalog-meta tr { border-bottom:1px solid; }
      .store-log .store-datalog-meta th { color:#666; width:95px; font-weight:bold; text-align:right; }
      .store-log .store-datalog-meta td { color:#666; padding:8px; }
      .store-log .store-datalog-meta td span { display:inline-block; text-align:right; width:80px; margin-right:5px; color:#000; font-weight:bold; font-size:16px; }
      .store-log .form-group { margin-bottom:0; }
      .store-log .store-datalog-filtered-list { height:580px; overflow-y:scroll; }
      .store-log .store-datalog-filtered-list p { font-weight:bold; color:#666; font-size:13px; margin:0; cursor:pointer; }
      .store-log .store-datalog-filtered-list p.on { font-size:14px; margin:5px 0; background:#ddd; }
      .store-log .store-datalog-filtered-list p:hover { background:#e7f0f8; }
      .store-log .store-datalog-filtered-list p.DANGER { color:#ff2f44; }
      .store-log .store-datalog-filtered-list p.WARN { color:#efaf77; }
      .store-log .store-datalog-filtered-list p button { display:none; margin-left:10px; }
      .store-log .store-datalog-filtered-list p.on button { display:inline-block; }
      .store-log-sensor-list { margin-bottom:20px; height:180px; overflow-y:scroll; }
      .store-log-sensor-list p { position:relative; padding:5px 10px; font-size:14px; font-weight:bold; color:#2b559b; margin-bottom:7px; }
      .store-log-sensor-list p span { display:inline-block; width:30px; float:right; background:#8df; color:#fff; font-size:12px; font-weight:bold; text-align:center; text-shadow:1px 1px 5px #000; padding:3px 5px; border-radius:8px; }
      .store-log-sensor-list p span.cnt2 { display:none; }
      .store-log-sensor-list p.danger { color:#ff2f44; }
      .store-log-sensor-list p.warn { color:#efaf77; }
      .store-log-sensor-list p.danger span { color:#fff; background:#f88; }
      .store-log-sensor-list p.danger span.cnt2 { display:inline-block; color:#fff; background:#fd8; }
      .store-log-sensor-list p.warn span { color:#fff; background:#fd8; }
      .store-log-sensor-list p.discon span { color:#fff; background:#999; }
    </style>
    <style type="text/css">
      .store-chart-sensor-list { margin-bottom:20px; height:150px; overflow-y:scroll; }
      .store-chart-sensor-list p { position:relative; padding:5px 10px; font-size:14px; font-weight:bold; color:#2b559b; margin-bottom:7px; }
      .store-chart-sensor-list p span { display:inline-block; width:30px; float:right; background:#8df; color:#fff; font-size:12px; font-weight:bold; text-align:center; text-shadow:1px 1px 5px #000; padding:3px 5px; border-radius:8px; }
      .store-chart-sensor-list p span.cnt2 { display:none; }
      .store-chart-sensor-list p.danger { color:#ff2f44; }
      .store-chart-sensor-list p.warn { color:#efaf77; }
      .store-chart-sensor-list p.danger span { color:#fff; background:#f88; }
      .store-chart-sensor-list p.danger span.cnt2 { display:inline-block; color:#fff; background:#fd8; }
      .store-chart-sensor-list p.warn span { color:#fff; background:#fd8; }
      .store-chart-sensor-list p.discon span { color:#fff; background:#999; }
    </style>
    <style type="text/css">
      @media (min-width: 768px) {
        .mt-md-n7 { margin-top: -100px !important; }
      }
    </style>
  </head>
  <body class="mod-bg-1 mod-nav-link">
    <div class="top"><th:block th:replace="mng/layout/m_top"></th:block></div>
    <div class="row">
      <div class="left col-md-2 mt-md-n7 col-12 mt-0"><th:block th:replace="mng/layout/m_left"></th:block></div>
      <div class="center col-md-8 col-12">

        <div id="center-main-cont" class="center-main-cont">
          <div class="row">
            <div class="col-12 sortable-grid ui-sortable"></div>
          </div>
        </div>

        <div class="center-store-cont">
          <div class="row center-top p-1">
            <div class="area-name col-3"></div>
            <div class="area-stat col-9">
              전체<span class="total" style="color:#afd9ee;"></span> |
              경고<span class="danger" style="color:#e082ae;"></span> |
              주의<span class="warn" style="color:#dbc969;"></span> |
              끊김<span class="discon" style="color:#dddddd;"></span>
            </div>
          </div>
          <div class="row">
            <div class="center-left col-md-3 col-12">
              <div class="row">
                <div class="col-12">
                  <div class="center-left-sensor-list"></div>
                </div>
              </div>
            </div>
            <div class="col-md-9 center-cont col-12">
              <div class="row center-cont-top">
                <div class="store-name col-4"></div>
                <div class="cont-btn col-8">
                  <span class="center-cont-top-btn on" data-page="Info">기본정보</span>
                  <span class="center-cont-top-btn" data-page="Log">경보이력</span>
                  <span class="center-cont-top-btn" data-page="Chart">분석차트</span>
                  <span class="center-main-btn">Main Page</span>
                </div>
              </div>
              <div class="row center-cont-page"></div>
            </div>
          </div>
        </div>

      </div>
      <div class="right col-md-2 mt-md-n7 col-12 mt-0"><th:block th:replace="mng/layout/m_right"></th:block></div>
    </div>
    <div class="bottom"><th:block th:replace="mng/layout/m_bottom"></th:block></div>
    <script th:src="@{/fs/js/polyfill.min.js}"></script>
    <script th:src="@{/fs/js/apexcharts.js}"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=meqwtbwfkw&submodules=visualization"></script>
    <script type="text/javascript">
      $(function() {
        fn_init();
      });

      function fn_init() {
        $.template('center-left-store',
          '<p class="{{html STATE}}" data-areacode="{{html AREACODE}}" data-strcode="{{html STRCODE}}"' +
          ' data-strname="{{html STRNAME}}">({{html SNSRCOUNT}}) {{html STRNAME}} ' +
          '<span class="cnt2">{{html CNT2}}</span><span>{{html CNT}}</span></p>');
        fn_initMainAreaList();
        $('.center-left-sensor-list').on('click', 'p', function() {
          $('.center-left-sensor-list p.on').removeClass('on');
          $(this).addClass('on');
          $('.center-cont-top .store-name').text($(this).attr('data-strname'));
          fn_clickContPage();
        });
        $('.center-cont-top').on('click', '.center-cont-top-btn', function() {
          $('.center-cont-top-btn.on').removeClass('on');
          $(this).addClass('on');
          fn_clickContPage();
        });
        $('.center-cont-page').on('click', '.btn-chart', function() {
          $('.center-cont-top-btn.on').removeClass('on');
          $('.center-cont-top-btn[data-page="Chart"]').addClass('on');
          fn_clickContPage({
            areacode:$('#prm_areacode').val(),
            strcode:$('#prm_strcode').val(),
            snsrid:$(this).attr('data-snsrid'),
            regdate:$(this).attr('data-regdate'),
            almtype:$(this).attr('data-almtype')
          });
        });
        $('.center-cont-page').on('click', '.btn-datalog', function() {
          $('.center-cont-top-btn.on').removeClass('on');
          $('.center-cont-top-btn[data-page="Log"]').addClass('on');
          fn_clickContPage({
            areacode:$('#prm_areacode').val(),
            strcode:$('#prm_strcode').val(),
            snsrid:$(this).attr('data-snsrid'),
            regdate:$(this).attr('data-regdate'),
            checktype:$(this).attr('data-checktype')
          });
        });
        $('.center-main-btn').on('click', function() {
          window.center_name = 'main';
          fn_toggleCenterCont();
        });
        $('.center-main-cont').on('click', '.js-panel-collapse', function() {
          var id = '#'+$(this).attr('data-id');
          if( $(this).hasClass('on') ) {
            $(this).removeClass('on');
            $(id+' .panel-container').removeClass('show');
          } else {
            $(this).addClass('on');
            $(id+' .panel-container').addClass('show');
            fn_updateMainAreaList();
          }
        });
        $('.center-main-cont').on('click', '.js-panel-fullscreen', function() {
          var id = '#'+$(this).attr('data-id');
          if( $(this).hasClass('on') ) {
            $(this).removeClass('on');
            $(id).removeClass('panel-fullscreen');
          } else {
            $(this).addClass('on');
            $(id).addClass('panel-fullscreen');
            fn_updateMainAreaList();
            fn_getMainAreaWeek();
          }
        });
        $('.center-main-cont').on('click', '.center-main-cont-top-btn', function() {
          $('.panel-fullscreen .center-main-cont-top-btn.on').removeClass('on');
          $(this).addClass('on');
          fn_tapCenterMainPage();
        });

        setInterval(fn_refresh, 1000*60);
        //setTimeout(function() { $('.left .area-lv2')[0].click(); }, 800);
      }

      function fn_refresh() {
        fn_refreshTop();
        fn_refreshLeft();
        fn_refreshRight();
        if(window.center_name == 'main') {
          fn_updateMainAreaList();
          fn_getMainAreaWeek();
        } else {
          fn_refreshStoreInfo();
          setTimeout(function() {
            fn_onAreaLv2(window.left_area_lv2_on_code);
          }, 800);
        }
      }

      function fn_clickAreaLv2(code) {
        window.center_name = 'store';
        fn_toggleCenterCont();
        fn_getAreaSensorCount(code);
        fn_getAreaStoreList(code);
      }

      function fn_onAreaLv2(code, strcode) {
        if(code) {
          $('.left .area-lv2').removeClass('on');
          $('.left .area-lv2[data-code="'+code+'"]').addClass('on');
          fn_getAreaSensorCount(code);
          fn_getAreaStoreList(code, strcode);
        }
      }

      function fn_clickRightSensor(code, strcode) {
        window.center_name = 'store';
        fn_toggleCenterCont();
        fn_onAreaLv2(code, strcode);
      }

      function fn_getAreaSensorCount(code) {
        $.post($('#contextRoot').val()+'/mng/areaSensorCountAjax',{areacode: code},
          function(d) {
            $('.center .area-name').text(d[0].AREANAME);
            $('.center .area-stat .total').text(d[0].TOTAL);
            $('.center .area-stat .danger').text(d[0].DANGER);
            $('.center .area-stat .warn').text(d[0].WARN);
            $('.center .area-stat .discon').text(d[0].DISCON);
          });
      }

      function fn_getAreaStoreList(code, strcode) {
        var on_strcode = $('.center-left-sensor-list p.on').attr('data-strcode');
        if(strcode) on_strcode = strcode;
        $.post($('#contextRoot').val()+'/mng/areaStoreListAjax',{areacode: code},
          function(d) {
            $('.center-left-sensor-list').html('');
            for(var i=0; i<d.length; i++) {
              d[i].CNT = 0;
              if(d[i].DANGER > 0) {
                d[i].STATE = 'danger';
                d[i].CNT = d[i].DANGER;
                d[i].CNT2 = d[i].WARN;
              } else if(d[i].WARN > 0) {
                d[i].STATE = 'warn';
                d[i].CNT = d[i].WARN;
              } else if(d[i].CON == 0) {
                d[i].STATE = 'discon';
              }
              $('.center-left-sensor-list').append($.tmpl('center-left-store',d[i]));
            }
            var on_obj = $('.center-left-sensor-list p[data-strcode="'+on_strcode+'"]')[0];
            if(!on_obj) on_obj = $('.center-left-sensor-list p')[0];
            $(on_obj).addClass('on');
            $('.center-cont-top .store-name').text($(on_obj).attr('data-strname'));
            if($('#prm_strcode').val()!=$('.center-left-sensor-list p.on').attr('data-strcode')) fn_clickContPage();
          });
      }

      function fn_clickContPage(p) {
        var prm = {};
        prm.areacode = $('.center-left-sensor-list p.on').attr('data-areacode');
        prm.strcode = $('.center-left-sensor-list p.on').attr('data-strcode');
        if(p) prm = p;
        var page = $('.center-cont-top-btn.on').attr('data-page');
        $.post($('#contextRoot').val()+'/mng/store'+page, prm,
          function (d) {
            var $temp = $('<div>');
            $temp.html(d);
            $('.center-cont-page').html($temp.find('.sub-cont'));
          });
      }

      function fn_toggleCenterCont() {
        if(window.center_name == 'main') {
          $('.center-main-cont').show();
          $('.center-store-cont').hide();
          fn_updateMainAreaList();
        } else {
          $('.center-main-cont').hide();
          $('.center-store-cont').show();
        }
      }

      function fn_initMainAreaList() {
        window.min_category = [];
        for(var i=0; i<24; i++) for(var j=0; j<6; j++)
          window.min_category.push(('0'+i).slice(-2)+':'+(j+'0'));
        $.post($('#contextRoot').val()+'/mng/areaListAjax',{},function(d) {
          $('.center-main-cont .sortable-grid').html('');
          if(d){
            window.area = d;
            window.lv1cnt = 0;
            for(var i=d.length-1; i>=0; i--) {
              if(d[i].LEVEL != 1) {
                window.lv1cnt++;

                $.post($('#contextRoot').val()+'/mng/mainArea',
                  { panel_index:'panel-'+i, areacode:d[i].CODE },
                  function (cont) {
                    var $temp = $('<div>');
                    $temp.html(cont);
                    $('.center-main-cont .sortable-grid').append($temp.find('.sub-cont').html());
                    if(window.lv1cnt==$('.center-main-cont .panel').length) {
                      $('#center-main-cont').smartPanel({ localStorage: true });
                      $($('.center-main-cont .panel-container')[0]).addClass('show');
                      $($('.center-main-cont .panel-container')[1]).addClass('show');
                    }
                    window.center_name = 'main';
                    fn_toggleCenterCont();
                });

              }
            }
          }
        });
      }

      function fn_updateMainAreaList() {
        $.post($('#contextRoot').val()+'/mng/areaListAjax',{},function(d) {
          if(d){
            window.area = d;
            var show_panel = $('.center-main-cont .panel-container');
            for(var i=0; i < show_panel.length; i++) {
              fn_setMainArea($(show_panel[i]).attr('data-id').replace('panel-',''));
            }
          }
        });
      }

      function fn_setMainArea(i) {
        var panel_id = 'panel-'+i;
        $('#'+panel_id+' .center-main-area-title').text(window.area[i].NAME);
        $('#'+panel_id+' .center-main-area-count-store').text(window.area[i].STORE);
        $('#'+panel_id+' .center-main-area-count-sensor').text(window.area[i].SENSOR);
        $('#'+panel_id+' .center-main-area-count-danger').text(window.area[i].DANGER);
        $('#'+panel_id+' .center-main-area-count-warn').text(window.area[i].WARN);
        $('#'+panel_id+' .center-main-area-count-discon').text(window.area[i].DISCON);
        if($('#'+panel_id).hasClass('panel-fullscreen') || $('#'+panel_id+' .panel-container').hasClass('show')) {
          $.post($('#contextRoot').val()+'/mng/mainAreaDataChartAjax',
            { areacode:window.area[i].CODE },
            function (data) {
              fn_setChart('데이터 수신 현황', '#'+panel_id+' .center-main-data-chart', data, ['#99ccff','#003399']);
          });
          $.post($('#contextRoot').val()+'/mng/mainAreaLogChartAjax',
            { areacode:window.area[i].CODE },
            function (data) {
              fn_setChart('경보 발생 현황', '#'+panel_id+' .center-main-log-chart', data, ['#ff9966','#cc3300']);
          });
        }
      }

      function fn_setChart(title, target, data, colors) {
        var opt = {
          series: [],
          chart: { height: 250, type: 'line', id: target, animations: {enabled: false}, },
          title: { text: title, align: 'left' },
          colors: colors,
          stroke: {width: 2},
          dataLabels: {enabled: false},
          tooltip: {
            enabled: true,
            marker: {show: true},
            fixed: { enabled: true, position: 'topLeft' },
            y: { formatter: function (val) { if(val) return val.toFixed(0); return null; } }
          },
          xaxis: { categories: window.min_category, tickAmount: 11, labels: { rotate:0 } },
          yaxis: { lines: {show: true}, tooltip: {enabled: true},
            labels: { formatter: function (val) { if(val) return val.toFixed(0); return null; } }
          },
          legend: { position:'top' }
        };
        var series = [{name:'어제', data:[]},{name:'오늘', data:[]}];
        var j = 0;
        var now_time = fn_dateToString(new Date()).slice(11,15)+'0';
        for (var i = 0; i < window.min_category.length; i++) {
          if(j < data.length-1 && data[j].RCVTIME==window.min_category[i]) series[0].data.push(data[j++].CNT);
          else if(window.min_category[i]) series[0].data.push(0);
        }
        for (var i = 0; i < window.min_category.length; i++) {
          if(j < data.length-1 && data[j].RCVTIME==window.min_category[i]) series[1].data.push(data[j++].CNT);
          else if(window.min_category[i] < now_time) series[1].data.push(0);
        }
        opt.markers = { size: 0, hover: {size: 0} };
        var target_id = target.replace(/ /g,'-');
        if (window['chart-'+target_id]) {
          window['chart-'+target_id].updateOptions(opt);
          window['chart-'+target_id].updateSeries(series);
        } else {
          opt.series = series;
          $(target).html('');
          window['chart-'+target_id] = new ApexCharts(document.querySelector(target), opt);
          window['chart-'+target_id].render().then(function(){});
        }
      }

      function fn_getMainAreaWeek() {
        window.week_category = ['일','월','화','수','목','금','토'];
        var show_panel = $('.center-main-cont .panel-fullscreen .panel-container');
        for(var i = 0; i < show_panel.length; i++) {
          var idx = $(show_panel[i]).attr('data-id').replace('panel-','');
          $.post($('#contextRoot').val()+'/mng/mainAreaDataChartWeekAjax',
            { areacode:window.area[idx].CODE },
            function (data) {
              fn_setChartWeek('전력사용량 현황', '#panel-'+idx+' .center-main-data-chart-week', data, ['#99ccff','#003399']);
            });
          $.post($('#contextRoot').val()+'/mng/mainAreaLogChartWeekAjax',
            { areacode:window.area[idx].CODE },
            function (data) {
              fn_setChartWeek('경보 발생 현황', '#panel-'+idx+' .center-main-log-chart-week', data, ['#ff9966','#cc3300']);
            });
        }
      }


      function fn_setChartWeek(title, target, data, colors) {
        var opt = {
          series: [],
          chart: { height: 250, type: 'bar', id: target, animations: {enabled: false}, },
          title: { text: title, align: 'left' },
          colors: colors,
          plotOptions: {
            bar: { horizontal: false, borderRadius: 10, dataLabels: { position: 'bottom' } }
          },
          dataLabels: { enabled: true, style: { colors:['#fff'] }, dropShadow: { enabled:true },
            formatter: function (val) { if(val) return val.toFixed(0); return 0; }
          },
          annotations: {
            points: [{
              x: window.week_category[new Date().getDay()],
              seriesIndex: 1,
              label: { borderColor: '#775DD0', textAnchor: 'start', offsetY:-15, offsetX: 10,
                style: { color: '#ddd', background: '#775DD0', },
                text: '오늘',
              },
              marker: { size:0 }
            }]
          },
          tooltip: { enabled: true, marker: {show: true},
            fixed: { enabled: true, position: 'topLeft' },
            y: { formatter: function (val) { if(val) return val.toFixed(0); return 0; } }
          },
          xaxis: { categories: window.week_category, tickAmount: 11, labels: { rotate:0 } },
          yaxis: { lines: {show: true}, tooltip: {enabled: true},
            labels: { formatter: function (val) { if(val) return val.toFixed(0); return 0; }
            }
          },
          legend: { position:'top' }
        };
        var series = [{name:'저번주', data:[]},{name:'이번주', data:[]}];
        var j = 0;
        for (var i = 0; j < data.length && i < window.week_category.length; i++) {
          if((i+1) == data[j].WEEK) series[0].data.push(data[j++].CNT);
          else series[0].data.push(0);
        }
        for (var i = 0; j < data.length && i < window.week_category.length; i++) {
          if((i+1) == data[j].WEEK) series[1].data.push(data[j++].CNT);
          else series[1].data.push(0);
        }
        opt.markers = { size: 0, hover: {size: 0} };
        var target_id = target.replace(/ /g,'-');
        if (window['chart-'+target_id]) {
          window['chart-'+target_id].updateOptions(opt);
          window['chart-'+target_id].updateSeries(series);
        } else {
          opt.series = series;
          $(target).html('');
          window['chart-'+target_id] = new ApexCharts(document.querySelector(target), opt);
          window['chart-'+target_id].render().then(function(){});
        }
      }

      function fn_tapCenterMainPage() {
        var page_name = $('.panel-fullscreen .center-main-cont-top-btn.on').attr('data-page');
        $('.panel-fullscreen [class^=center-main-page]').removeClass('on');
        $('.panel-fullscreen .center-main-page-'+page_name).addClass('on');
        if(page_name=='map') fn_getMainAreaMap();
      }

      function fn_getMainAreaMap() {
        var show_panel = $('.center-main-cont .panel-fullscreen .panel-container .center-main-page-map.on');
        for(var i = 0; i < show_panel.length; i++) {
          var idx = $(show_panel[i]).attr('data-id').replace('panel-','');
          $.post($('#contextRoot').val()+'/mng/mainAreaMapSensorListAjax',
            { areacode:window.area[idx].CODE },
            function (data) {
              fn_setMapMarker('#panel-'+idx+' .center-main-page-map', data);
            });
        }
      }

      function fn_setMapMarker(target, data) {
        var target_id = target.replace(/ /g,'-');
        var mark = {
          normal: ['/fs/img/map/normal.png', 1],
          discon: ['/fs/img/map/disconnection.png', 0],
          danger: ['/fs/img/map/danger.png', 3],
          warning: ['/fs/img/map/warning.png', 2],
          select: ['/fs/img/map/select.png', 4]
        };
        if (!window['map-'+target_id]) {
          var options = {center: new naver.maps.LatLng(33.450701, 126.570667), zoom: 19};
          window['map-'+target_id] = new naver.maps.Map($(target)[0], options);
          window['map-'+target_id].marker=[];
        }
        for (var i = 0; i < window['map-'+target_id].marker.length; i++) window['map-'+target_id].marker[i].setMap(null);
        if (data.length > 0) {
          for (var i = 0; i < data.length; i++) {
            var pos = new naver.maps.LatLng(data[i].STRPOSLAT, data[i].STRPOSLON);
            if (i == 0) window['map-'+target_id].setCenter(pos);
            window['map-'+target_id].marker.push(new naver.maps.Marker({
              map: window['map-'+target_id],
              title: data[i].STRNAME+' > '+data[i].SNSRNICK,
              position: pos,
              zIndex: mark[data[i].STATE][1],
              icon: {
                url: $('#contextRoot').val()+mark[data[i].STATE][0],
                size: new naver.maps.Size(26, 35),
                scaledSize: new naver.maps.Size(26, 35),
                origin: new naver.maps.Point(0, 0),
                anchor: new naver.maps.Point(13, 35)
              }
            }));
          }
        }
      }

    </script>
  </body>
</html>