<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.fscom.firsens.sys.repository.SYSAreaRepo">
    <select id="SELECT_LIST_SYS_AREA" parameterType="SYSAreaDomain" resultType="SYSAreaDomain">
        WITH RECURSIVE t AS (
            SELECT AREACODE
                 , AREANAME
                 , AREAORDER
                 , UPAREACODE
                 , AREAPOSLAT
                 , AREAPOSLON
                 , AREAMANAGER
                 , AREATEL
                 , USEYN
                 , DELYN
                 , USERID
                 , REGDATE
                 , AREALEVEL
                 , GUCODE
            FROM F_LEVEL_AREA
            WHERE AREALEVEL = 1
            UNION ALL
            SELECT B.AREACODE
                 , B.AREANAME
                 , B.AREAORDER
                 , B.UPAREACODE
                 , B.AREAPOSLAT
                 , B.AREAPOSLON
                 , B.AREAMANAGER
                 , B.AREATEL
                 , B.USEYN
                 , B.DELYN
                 , B.USERID
                 , B.REGDATE
                 , B.AREALEVEL
                 , B.GUCODE
            FROM F_LEVEL_AREA B
                     INNER JOIN t
                                ON B.UPAREACODE = t.AREACODE
        )
        SELECT t.AREACODE                                   AS areaCode
             , AREANAME                                     AS areaName
             , AREAORDER                                    AS areaOrder
             , UPAREACODE                                   AS upAreaCode
             , AREAPOSLAT                                   AS areaPosLat
             , AREAPOSLON                                   AS areaPosLon
             , AREAMANAGER                                  AS areaManager
             , AREATEL                                      AS areaTel
             , USEYN                                        AS useYn
             , DELYN                                        AS delYn
             , USERID                                       AS userId
             , DATE_FORMAT(REGDATE, '%Y-%m-%d %H:%i:%s')    AS regDate
             , AREALEVEL                                    AS areaLevel
             , GUCODE                                       AS guCode
             , IFNULL(FS.STORECNT, 0)                       AS storeCnt
        FROM t
     LEFT JOIN ( SELECT AREACODE, COUNT( AREACODE ) AS STORECNT FROM F_STORE GROUP BY AREACODE ) FS
               ON t.AREACODE = FS.AREACODE
        WHERE 1 = 1
     ORDER BY areaLevel, areaOrder
     LIMIT #{page}, #{sizePerPage}
    </select>

    <select id="SELECT_CNT_SYS_AREA" parameterType="SYSAreaDomain" resultType="int">
        SELECT COUNT( AREACODE )
        FROM F_LEVEL_AREA
        WHERE 1 = 1
    </select>
</mapper>
