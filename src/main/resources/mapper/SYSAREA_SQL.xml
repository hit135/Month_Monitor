<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.fscom.firsens.sys.repository.SYSAreaRepo">
    <select id="SELECT_LIST_SYS_AREA" parameterType="SYSAreaDomain" resultType="SYSAreaDomain">
--         SELECT A.AREACODE                                                  AS 'key'
--              , A.AREANAME                                                  AS areaName
--              , A.AREANAME                                                  AS title
--              , A.AREAORDER                                                 AS areaOrder
--              , A.UPAREACODE                                                AS upAreaCode
--              , A.USEYN                                                     AS useYn
--              , A.DELYN                                                     AS delYn
--              , A.AREALEVEL                                                 AS areaLevel
--              , IFNULL(FS.STORECNT, 0)                                    AS storeCnt
--         FROM F_LEVEL_AREA A
--                  LEFT JOIN (SELECT AREACODE, COUNT(AREACODE) AS STORECNT FROM F_STORE GROUP BY AREACODE) FS
--                            ON A.AREACODE = FS.AREACODE
--         WHERE 1 = 1
--         ORDER BY areaLevel, areaOrder
            WITH RECURSIVE t AS (
                SELECT AREACODE AS top_wr_no
                     , AREACODE
                     , AREANAME
                     , UPAREACODE
                     , USEYN
                FROM F_LEVEL_AREA
                WHERE UPAREACODE = '0'

                UNION ALL

                SELECT t.top_wr_no
                     , a.AREACODE
                     , a.AREANAME
                     , a.UPAREACODE
                     , a.USEYN
                FROM F_LEVEL_AREA a
                         JOIN t
                              ON a.UPAREACODE = t.AREACODE
            )
            SELECT AREACODE as 'key', AREACODE as areaCode,  UPAREACODE as upAreaCode, AREANAME AS title
            FROM t
            WHERE 1 = 1
              AND USEYN = 'Y'
    </select>
</mapper>
