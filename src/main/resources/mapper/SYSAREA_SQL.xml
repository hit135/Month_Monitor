<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.fscom.firsens.sys.repository.SYSAreaRepo">
    <select id="SELECT_LIST_SYS_AREA" parameterType="SYSAreaDomain" resultType="SYSAreaDomain">
        SELECT AREACODE as 'key'
             , AREACODE as areaCode
             , UPAREACODE as upAreaCode
             , AREANAME AS title
             , IFNULL((SELECT COUNT(AREACODE) AS STORECNT FROM F_STORE WHERE A.AREACODE = AREACODE GROUP BY AREACODE), 0) AS storeCnt
        FROM F_LEVEL_AREA A
        WHERE 1 = 1
          AND USEYN = 'Y'
    </select>

    <insert id="INSERT_SYS_AREA_ITEM" parameterType="SYSAreaDomain" >
        INSERT INTO F_AREA (
            AREACODE
          , AREANAME
          , USEYN
          , AREAORDER
          , REGDATE
       ) VALUES (
            CONCAT('AREA_', LPAD(IFNULL((SELECT COUNT(FA.AREACODE) FROM F_AREA FA), 0) + 1, '6', '0'))
           , 'temp'
           , 'Y'
           , (SELECT IFNULL(MAX(FA.AREAORDER), 0) + 1 FROM F_AREA FA)
           , NOW()
       )
    </insert>

    <insert id="INSERT_SYS_LEVEL_AREA_ITEM" parameterType="SYSAreaDomain">
        INSERT INTO F_LEVEL_AREA (
               AREACODE
             , UPAREACODE
             , AREANAME
             , USEYN
             , AREAORDER
             , REGDATE
        )
        VALUES (
               CONCAT('AREA_', LPAD(IFNULL((SELECT COUNT(FA.AREACODE) FROM F_AREA FA), 0) + 1, '6', '0'))
             , '0'
             , 'temp'
             , 'Y'
             , (SELECT IFNULL(MAX(FA.AREAORDER), 0) + 1 FROM F_LEVEL_AREA FA WHERE UPAREACODE = '0')
             , NOW()
        );
    </insert>
</mapper>
