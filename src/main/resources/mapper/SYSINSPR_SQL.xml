<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.fscom.firsens.sys.repository.SYSInsprRepo">

    <select id="LIST_SYS_INSPRAREA" resultType="map">
        SELECT AREACODE AS areaCode
             , AREANAME AS areaName
          FROM F_LEVEL_AREA
         WHERE AREALEVEL = 1 AND USEYN = 'Y' AND DELYN = 'N'
         ORDER BY AREACODE
    </select>

    <select id="LIST_SYS_INSPECTORS" parameterType="map" resultType="map">
        SELECT I.INSPID AS inspId
             , I.INSPNAME As inspName
             , I.INSPEMAIL AS inspEmail
             , I.INSPTEL AS inspTel
             , I.INSPMOBILE AS inspMobile
             , I.INSPAREACODE AS inspAreaCode
             , A.AREANAME AS inspAreaName
             , I.INSPSHOPNAME AS inspShopName
          FROM F_INSPECTOR I
                LEFT JOIN ( SELECT AREACODE, AREANAME FROM F_LEVEL_AREA WHERE AREALEVEL = 1 ) A
                    ON I.INSPAREACODE = A.AREACODE
         WHERE I.USEYN = #{useYn}
           AND I.ALARMUSE = #{alarmUse}
           <if test='loginLock == "Y"'>AND LOGINFAILCNT >= 5</if>
           <if test='searchWrd != null and searchWrd != ""'>
           AND (    I.INSPID LIKE CONCAT('%', #{searchWrd}, '%')
                 OR I.INSPNAME LIKE CONCAT('%', #{searchWrd}, '%') )
           </if>
           <if test='inspAreaCode != ""'>AND I.INSPAREACODE = #{inspAreaCode}</if>
         ORDER BY I.REGDATE DESC
         LIMIT #{page}, #{sizePerPage}
    </select>

    <select id="CNT_SYS_INSPECTORS" parameterType="map" resultType="int">
        SELECT COUNT(INSPID)
          FROM F_INSPECTOR
         WHERE USEYN = #{useYn}
           AND ALARMUSE = #{alarmUse}
           <if test='loginLock == "Y"'>AND LOGINFAILCNT >= 5</if>
           <if test='searchWrd != null and searchWrd != ""'>
           AND (    INSPID LIKE CONCAT('%', #{searchWrd}, '%')
                 OR INSPNAME LIKE CONCAT('%', #{searchWrd}, '%') )
           </if>
           <if test='inspAreaCode != ""'>AND INSPAREACODE = #{inspAreaCode}</if>
    </select>

    <select id="CNT_SYS_DUPCHK_INSPID" parameterType="map" resultType="int">
        SELECT COUNT(INSPID)
          FROM F_INSPECTOR
         WHERE INSPID = #{inspId}
    </select>

    <insert id="INSERT_SYS_INSPECTOR" parameterType="map">
        INSERT INTO F_INSPECTOR (
                    INSPID
                  , INSPPASS
                  , INSPNAME
                  , INSPEMAIL
                  , INSPTEL
                  , INSPMOBILE
                  , INSPAREACODE
                  , INSPSHOPNAME
                  , INSPADDR
                  , ALARMUSE
                  , PUSHUSE
                  , SMSUSE
                  , USEYN
                  , REGDATE
                  , INSPRSNTDATE
                  , LOGINFAILCNT
        ) VALUES (
                    #{inspId}
                  , #{inspPass}
                  , #{inspName}
                  , #{inspEmail}
                  , #{inspTel}
                  , #{inspMobile}
                  , #{inspAreaCode}
                  , #{inspShopName}
                  , #{inspAddr}
                  , 'Y'
                  , 'Y'
                  , 'Y'
                  , 'Y'
                  , NOW()
                  , NOW()
                  , 0
        )
    </insert>

</mapper>
